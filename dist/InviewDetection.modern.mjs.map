{"version":3,"file":"InviewDetection.modern.mjs","sources":["../src/index.js"],"sourcesContent":["export default class InviewDetection {\n\tconstructor(options = {}) {\n\t\tthis.elements = options.elements || '[data-inview]'\n\t\tthis.duration = options.duration || 1\n\t\tthis.delay = options.delay || 1\n\t\tthis.start = options.start || 'top 90%'\n\t\tthis.ease = options.ease || 'power4'\n\t\tthis.stagger = options.stagger || 0.155\n\t\tthis.init()\n\t}\n\n\tinit() {\n\t\t/**\n\t\t * Loop through each parent\n\t\t */\n\t\tgsap.utils.toArray(this.elements).forEach((oParent) => {\n\t\t\t/**\n\t\t\t * Determine what elements are to be animated\n\t\t\t */\n\n\t\t\t/* Create empty array of animated elements */\n\t\t\tvar aAnimatedElements = []\n\n\t\t\t/* Check elements  */\n\t\t\tif (!oParent.hasAttribute('data-inview-scope')) {\n\t\t\t\t/* Add parent element if scope isn't set */\n\t\t\t\taAnimatedElements.push({\n\t\t\t\t\tel: oParent,\n\t\t\t\t\torder: oParent.dataset.inviewOrder,\n\t\t\t\t})\n\t\t\t} else {\n\t\t\t\t/* Add elements that are defined in parent scope via `data-inview-scope` attribute */\n\t\t\t\tif (oParent.dataset.inviewScope) {\n\t\t\t\t\toParent.querySelectorAll(':scope ' + oParent.dataset.inviewScope).forEach((element) => {\n\t\t\t\t\t\tconst order = parseFloat(element.dataset.inviewOrder)\n\t\t\t\t\t\taAnimatedElements.push({\n\t\t\t\t\t\t\tel: element,\n\t\t\t\t\t\t\torder: order,\n\t\t\t\t\t\t})\n\t\t\t\t\t})\n\t\t\t\t}\n\n\t\t\t\t/* Add attributed elements that are children with `data-inview-child` attribute */\n\t\t\t\tif (oParent.querySelectorAll(':scope [data-inview-child]')) {\n\t\t\t\t\toParent.querySelectorAll(':scope [data-inview-child]').forEach((element) => {\n\t\t\t\t\t\tconst order = parseFloat(element.dataset.inviewOrder)\n\t\t\t\t\t\taAnimatedElements.push({\n\t\t\t\t\t\t\tel: element,\n\t\t\t\t\t\t\torder: order,\n\t\t\t\t\t\t})\n\t\t\t\t\t})\n\t\t\t\t}\n\n\t\t\t\t/* Add SplitText elements that are defined with `data-inview-split` attribute */\n\t\t\t\tif (oParent.querySelectorAll(':scope *:where([data-inview-split])')) {\n\t\t\t\t\tvar aElementsToSplit = []\n\n\t\t\t\t\tconst aSplitElements = oParent.querySelectorAll(':scope *:where([data-inview-split])')\n\t\t\t\t\tconst aSplitElementsParent = Array.from(aSplitElements).filter(\n\t\t\t\t\t\t(oElement) => oElement.dataset.inviewSplit\n\t\t\t\t\t)\n\t\t\t\t\tconst aSplitElementsSelf = Array.from(aSplitElements).filter(\n\t\t\t\t\t\t(oElement) => !oElement.dataset.inviewSplit\n\t\t\t\t\t)\n\n\t\t\t\t\tif (aSplitElementsSelf) {\n\t\t\t\t\t\taElementsToSplit = Array.prototype.concat.apply(aElementsToSplit, aSplitElementsSelf)\n\t\t\t\t\t}\n\n\t\t\t\t\tif (aSplitElementsParent) {\n\t\t\t\t\t\taSplitElementsParent.forEach((oSplitParent) => {\n\t\t\t\t\t\t\tconst oSplitChildren = oSplitParent.querySelectorAll(\n\t\t\t\t\t\t\t\t':scope ' + oSplitParent.dataset.inviewSplit\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\taElementsToSplit = Array.prototype.concat.apply(aElementsToSplit, oSplitChildren)\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\n\t\t\t\t\taElementsToSplit.forEach((oSplitElement) => {\n\t\t\t\t\t\tvar iOrder = fnFindClosestParentOrderAttr(oSplitElement)\n\t\t\t\t\t\tconst oSplitChildren = new SplitText(oSplitElement, {\n\t\t\t\t\t\t\ttype: 'lines',\n\t\t\t\t\t\t\tlinesClass: 'lineChild',\n\t\t\t\t\t\t})\n\n\t\t\t\t\t\toSplitChildren.lines.forEach((oLine) => {\n\t\t\t\t\t\t\tif (iOrder) {\n\t\t\t\t\t\t\t\tiOrder += 0.01\n\t\t\t\t\t\t\t\toLine.dataset.inviewOrder = iOrder.toFixed(2)\n\t\t\t\t\t\t\t\taAnimatedElements.push({\n\t\t\t\t\t\t\t\t\tel: oLine,\n\t\t\t\t\t\t\t\t\torder: iOrder,\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\taAnimatedElements.push({\n\t\t\t\t\t\t\t\t\tel: oLine,\n\t\t\t\t\t\t\t\t\torder: false,\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/* Function to find the closest parent containing the order attribute */\n\t\t\tfunction fnFindClosestParentOrderAttr(oElement) {\n\t\t\t\tlet oParent = oElement.parentElement\n\t\t\t\tlet iAncestorsIndexed = 0\n\t\t\t\tlet iAncestorsLimit = 5\n\t\t\t\twhile (oParent && iAncestorsIndexed <= iAncestorsLimit) {\n\t\t\t\t\tif (oParent.hasAttribute('data-inview-order')) {\n\t\t\t\t\t\treturn parseFloat(oParent.getAttribute('data-inview-order'))\n\t\t\t\t\t}\n\t\t\t\t\toParent = oParent.parentElement\n\t\t\t\t\tiAncestorsIndexed++\n\t\t\t\t}\n\t\t\t\tif (oElement.hasAttribute('data-inview-order')) {\n\t\t\t\t\tconst value = oElement.getAttribute('data-inview-order')\n\t\t\t\t\treturn Number.isInteger(+value) ? +value : false\n\t\t\t\t}\n\t\t\t\treturn false\n\t\t\t}\n\n\t\t\t/* Reorder elements based on their order value */\n\t\t\taAnimatedElements.sort((a, b) => {\n\t\t\t\tif (isNaN(a['order']) || a['order'] === false || a['order'] === null || a['order'] === undefined) {\n\t\t\t\t\treturn 1 // preserve original order of NaN/false/null values\n\t\t\t\t} else if (\n\t\t\t\t\tisNaN(b['order']) ||\n\t\t\t\t\tb['order'] === false ||\n\t\t\t\t\tb['order'] === null ||\n\t\t\t\t\tb['order'] === undefined\n\t\t\t\t) {\n\t\t\t\t\treturn -1 // preserve original order of NaN/false/null values\n\t\t\t\t} else {\n\t\t\t\t\treturn a['order'] - b['order'] // sort by order value\n\t\t\t\t}\n\t\t\t})\n\n\t\t\taAnimatedElements = aAnimatedElements.map((oElement) => oElement.el)\n\n\t\t\t/**\n\t\t\t * Initial animate FROM properties\n\t\t\t */\n\t\t\tvar aAnimateFromProperties = {\n\t\t\t\topacity: 0,\n\t\t\t\t'will-change': 'transform',\n\t\t\t\ty: 20,\n\t\t\t}\n\n\t\t\tif (oParent.dataset.inviewFrom) {\n\t\t\t\taAnimateFromProperties = JSON.parse(oParent.dataset.inviewFrom)\n\t\t\t}\n\t\t\tgsap.set(aAnimatedElements, aAnimateFromProperties)\n\n\t\t\t/**\n\t\t\t * Animate TO properties (based on scroll position)\n\t\t\t */\n\t\t\tvar aAnimateToProperties = {\n\t\t\t\topacity: 1,\n\t\t\t\ty: 0,\n\t\t\t}\n\n\t\t\tif (oParent.dataset.inviewTo) {\n\t\t\t\taAnimateToProperties = JSON.parse(oParent.dataset.inviewTo)\n\t\t\t}\n\n\t\t\tScrollTrigger.batch(oParent, {\n\t\t\t\tstart: oParent.dataset.inviewStart || this.start,\n\t\t\t\tonEnter: () => {\n\t\t\t\t\tgsap.to(aAnimatedElements, {\n\t\t\t\t\t\t...aAnimateToProperties,\n\t\t\t\t\t\tduration: oParent.dataset.inviewDuration || this.duration,\n\t\t\t\t\t\tdelay: oParent.dataset.inviewDelay || this.delay,\n\t\t\t\t\t\tease: oParent.dataset.inviewEase || this.ease,\n\t\t\t\t\t\tstagger: {\n\t\t\t\t\t\t\teach: oParent.dataset.inviewStagger || this.stagger,\n\t\t\t\t\t\t\tfrom: 'start',\n\t\t\t\t\t\t},\n\t\t\t\t\t})\n\t\t\t\t\toParent.classList.add('has-viewed')\n\t\t\t\t},\n\t\t\t\tmarkers: oParent.hasAttribute('data-inview-debug') ? true : false,\n\t\t\t\ttoggleClass: {\n\t\t\t\t\ttargets: oParent,\n\t\t\t\t\tclassName: 'is-inview',\n\t\t\t\t},\n\t\t\t})\n\n\t\t\t/**\n\t\t\t * DEBUG\n\t\t\t */\n\t\t\tif (oParent.hasAttribute('data-inview-debug')) {\n\t\t\t\tconsole.group('InviewDetection debug instance')\n\t\t\t\tconsole.log('Parent:', oParent)\n\t\t\t\tconsole.log('Animating from:', aAnimateFromProperties)\n\t\t\t\tconsole.log('Animating to:', aAnimateToProperties)\n\t\t\t\tconsole.log('Queued elements:', aAnimatedElements)\n\t\t\t\tconsole.groupEnd()\n\t\t\t}\n\t\t})\n\t}\n}\n"],"names":["InviewDetection","constructor","options","this","elements","duration","delay","start","ease","stagger","init","gsap","utils","toArray","forEach","oParent","aAnimatedElements","hasAttribute","dataset","inviewScope","querySelectorAll","element","order","parseFloat","inviewOrder","push","el","aElementsToSplit","aSplitElements","aSplitElementsParent","Array","from","filter","oElement","inviewSplit","aSplitElementsSelf","prototype","concat","apply","oSplitParent","oSplitChildren","oSplitElement","iOrder","parentElement","iAncestorsIndexed","getAttribute","value","Number","isInteger","fnFindClosestParentOrderAttr","SplitText","type","linesClass","lines","oLine","toFixed","sort","a","b","isNaN","map","opacity","y","inviewFrom","aAnimateFromProperties","JSON","parse","set","aAnimateToProperties","inviewTo","ScrollTrigger","batch","inviewStart","onEnter","to","inviewDuration","inviewDelay","inviewEase","each","inviewStagger","classList","add","markers","toggleClass","targets","className","console","group","log","groupEnd"],"mappings":"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"}